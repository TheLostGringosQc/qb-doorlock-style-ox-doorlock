<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QB-Doorlock Interface</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', monospace;
            background: transparent;
            color: #fff;
            overflow: hidden;
            user-select: none;
        }

        .container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            height: auto;
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 2px solid #00d4ff;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(0, 212, 255, 0.3);
            padding: 30px;
            text-align: center;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .header {
            margin-bottom: 20px;
        }

        .door-icon {
            font-size: 48px;
            color: #00d4ff;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);
        }

        .title {
            font-size: 24px;
            font-weight: 700;
            color: #00d4ff;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        .subtitle {
            font-size: 14px;
            color: #a0a0a0;
            margin-bottom: 20px;
        }

        .code-input-container {
            position: relative;
            margin: 20px 0;
        }

        .code-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 18px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            text-align: center;
            letter-spacing: 8px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #333;
            border-radius: 10px;
            color: #00d4ff;
            outline: none;
            transition: all 0.3s ease;
        }

        .code-input:focus {
            border-color: #00d4ff;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
            background: rgba(0, 212, 255, 0.1);
        }

        .code-input::placeholder {
            color: #666;
            letter-spacing: 4px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }

        .btn {
            flex: 1;
            padding: 12px 20px;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
        }

        .btn-primary {
            background: linear-gradient(145deg, #00d4ff, #0099cc);
            color: #000;
            box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 212, 255, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(145deg, #333, #555);
            color: #fff;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            background: linear-gradient(145deg, #555, #777);
        }

        .security-indicator {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 15px 0;
        }

        .security-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #333;
            transition: all 0.3s ease;
        }

        .security-dot.active {
            background: #00d4ff;
            box-shadow: 0 0 10px rgba(0, 212, 255, 0.6);
        }

        .error-message {
            color: #ff4444;
            font-size: 12px;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .error-message.show {
            opacity: 1;
        }

        .access-denied {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translate(-50%, -50%); }
            25% { transform: translate(-48%, -50%); }
            75% { transform: translate(-52%, -50%); }
        }

        .loading {
            display: none;
            margin: 20px 0;
        }

        .spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #333;
            border-top: 3px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Keypad virtuel */
        .virtual-keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
            max-width: 200px;
            margin-left: auto;
            margin-right: auto;
        }

        .keypad-btn {
            width: 50px;
            height: 50px;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 1px solid #444;
            border-radius: 8px;
            color: #00d4ff;
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .keypad-btn:hover {
            background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
            transform: scale(1.05);
        }

        .keypad-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="container" id="codeInterface">
        <div class="header">
            <div class="door-icon">üîê</div>
            <div class="title">ACC√àS S√âCURIS√â</div>
            <div class="subtitle" id="doorLabel">Saisissez le code d'acc√®s</div>
        </div>

        <div class="security-indicator">
            <div class="security-dot"></div>
            <div class="security-dot"></div>
            <div class="security-dot"></div>
            <div class="security-dot"></div>
        </div>

        <div class="code-input-container">
            <input 
                type="password" 
                id="codeInput" 
                class="code-input" 
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                maxlength="4"
                autocomplete="off"
            >
        </div>

        <!-- Clavier virtuel -->
        <div class="virtual-keypad">
            <button class="keypad-btn" data-num="1">1</button>
            <button class="keypad-btn" data-num="2">2</button>
            <button class="keypad-btn" data-num="3">3</button>
            <button class="keypad-btn" data-num="4">4</button>
            <button class="keypad-btn" data-num="5">5</button>
            <button class="keypad-btn" data-num="6">6</button>
            <button class="keypad-btn" data-num="7">7</button>
            <button class="keypad-btn" data-num="8">8</button>
            <button class="keypad-btn" data-num="9">9</button>
            <button class="keypad-btn" data-action="clear">C</button>
            <button class="keypad-btn" data-num="0">0</button>
            <button class="keypad-btn" data-action="backspace">‚å´</button>
        </div>

        <div class="error-message" id="errorMessage">Code incorrect</div>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p style="margin-top: 10px; color: #a0a0a0;">V√©rification...</p>
        </div>

        <div class="buttons">
            <button class="btn btn-secondary" id="cancelBtn">ANNULER</button>
            <button class="btn btn-primary" id="submitBtn">VALIDER</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
        let currentDoorId = null;
        
        // √âl√©ments DOM
        const container = document.getElementById('codeInterface');
        const codeInput = document.getElementById('codeInput');
        const doorLabel = document.getElementById('doorLabel');
        const submitBtn = document.getElementById('submitBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const errorMessage = document.getElementById('errorMessage');
        const loading = document.getElementById('loading');
        const securityDots = document.querySelectorAll('.security-dot');

        // Clavier virtuel
        const keypadBtns = document.querySelectorAll('.keypad-btn');

        // Gestionnaires d'√©v√©nements pour le clavier virtuel
        keypadBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const num = btn.getAttribute('data-num');
                const action = btn.getAttribute('data-action');

                if (num && codeInput.value.length < 4) {
                    codeInput.value += num;
                    updateSecurityDots();
                } else if (action === 'clear') {
                    codeInput.value = '';
                    updateSecurityDots();
                } else if (action === 'backspace') {
                    codeInput.value = codeInput.value.slice(0, -1);
                    updateSecurityDots();
                }
            });
        });

        // Mise √† jour des indicateurs de s√©curit√©
        function updateSecurityDots() {
            const codeLength = codeInput.value.length;
            securityDots.forEach((dot, index) => {
                if (index < codeLength) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        // Afficher l'interface
        function showCodeInterface(doorId, label) {
            currentDoorId = doorId;
            doorLabel.textContent = label || 'Saisissez le code d\'acc√®s';
            container.style.display = 'block';
            codeInput.focus();
            codeInput.value = '';
            updateSecurityDots();
            hideError();
        }

        // Masquer l'interface
        function hideCodeInterface() {
            container.style.display = 'none';
            currentDoorId = null;
        }

        // Afficher/masquer l'erreur
        function showError(message = 'Code incorrect') {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
            container.classList.add('access-denied');
            setTimeout(() => {
                container.classList.remove('access-denied');
            }, 500);
        }

        function hideError() {
            errorMessage.classList.remove('show');
        }

        // Afficher/masquer le loading
        function showLoading() {
            loading.style.display = 'block';
            submitBtn.disabled = true;
        }

        function hideLoading() {
            loading.style.display = 'none';
            submitBtn.disabled = false;
        }

        // Soumettre le code
        function submitCode() {
            const code = codeInput.value;
            
            if (code.length !== 4) {
                showError('Le code doit contenir 4 chiffres');
                return;
            }

            showLoading();
            hideError();

            // Envoyer au client FiveM
            fetch(`https://${GetParentResourceName()}/submitCode`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    code: code,
                    doorId: currentDoorId
                })
            });

            // Simuler un d√©lai de v√©rification
            setTimeout(() => {
                hideLoading();
            }, 1500);
        }

        // Fermer l'interface
        function closeInterface() {
            hideCodeInterface();
            fetch(`https://${GetParentResourceName()}/closeCodeUI`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({})
            });
        }

        // Gestionnaires d'√©v√©nements
        submitBtn.addEventListener('click', submitCode);
        cancelBtn.addEventListener('click', closeInterface);

        codeInput.addEventListener('input', (e) => {
            // Ne garder que les chiffres
            e.target.value = e.target.value.replace(/[^0-9]/g, '');
            updateSecurityDots();
            hideError();
        });

        codeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                submitCode();
            } else if (e.key === 'Escape') {
                closeInterface();
            }
        });

        // √âcouter les messages du client FiveM
        window.addEventListener('message', (event) => {
            const data = event.data;
            
            switch (data.type) {
                case 'showCodeInput':
                    showCodeInterface(data.doorId, data.doorLabel);
                    break;
                    
                case 'codeResult':
                    if (data.success) {
                        hideCodeInterface();
                    } else {
                        showError('Code incorrect');
                        codeInput.value = '';
                        updateSecurityDots();
                    }
                    break;
                    
                case 'hideCodeInput':
                    hideCodeInterface();
                    break;
            }
        });

        // Emp√™cher la s√©lection et le clic droit
        document.addEventListener('contextmenu', (e) => e.preventDefault());
        document.addEventListener('selectstart', (e) => e.preventDefault());
    </script>
</body>
</html>